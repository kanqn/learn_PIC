## PICアセンブラ

### 値の書き込みについて

#### MOVLW B'00001111'  
文字列をWレジスタ(ALUのアキュムレータのようなレジスタ)に書き込む命令  
  
#### MOVWF PORTB
Wレジスタの内容をPORTBに書き込む  

なお、MOVLFのような文字列を直接渡すことはPICの命令長が14ビットに対して、  
リテラル→ファイルレジスタは14ビットを超えてしまうためできない  
  
### MCLRピン

電圧低下やプログラムミスでPICが不安定になる時があって誤動作解除に使う
MCLRピンがLレベルになるとPICマイコンがリセットされる
(MCLRリセット)

### 入出力設定

#### TRIS-A TRIS-B  
  
PICの入出力設定はTRIS-AとTRIS-Bという特殊機能レジスタで行う  
  
TRIS-A(5ビット幅のレジスタ)がAポートの入出力設定を行い、  
(RA0,RA1,RA2,RA3,RA4)  
  
TRIS-B(8ビット幅のレジスタ)がBポートの入出力設定を行う  
(RB0,RB1,RB2,RB3,RB4,RB5,RB6,RB7)  
  
なお、ビットが0なら出力,1なら入力となる  

#### CLRF TRISA

CLRF: レジスタの全ビットを0にする  
例: CLRF TRISA  (Aポートを全て出力に設定する)  
なお、逆となる**全ビット1にするというのはない**ため、  
全ビット1にしたい場合は、 MOVLW , MOVWFを使用する  

### バンクと切り替えについて
PICは電源投入時は、デフォルトだとBANK0にアクセスするため、  
BANK1にアクセスするためには(TRIS-AやTRIS-BはBANK1にある)バンク切り替えが必要  
切り替えにはSTATUSというレジスタを使用する  
  
#### STATUSレジスタ  

BANK0と1両方にある8ビットのレジスタで、バンク切り替えに使うビットはRP0(5ビット目)とRP1(6ビット目)  
ただし、PIC16F84AはRP0だけを使用する  
もちろんRP0ビットが0なら、BANK0になって、1ならBANK1となる。  

#### 実際のBANK切り替え  
  
BSF: ビットを**1**にしたい場合に使用  
例: BSF STATUS, RP0 (STATUSレジスタのRP0のビットを1にする、つまりはBANK1に切り替える)  
  
BCF: ビットを**0**にしたい場合に使用  
例: BCF STATUS, RP0 (STATUSレジスタのRP0のビットを0にする、つまりはBANK0に切り替える)  

なお、BANK1に切り替えた場合は、操作が終わった後は**必ずBANK0に戻すこと**  
  

#### MOVF f,d
ファイルレジスタの内容を格納先ｄに書き込む  
  
入力設定してるPORT-AをPORT-Bに出力する例  
例: MOVF PORTA, W (PORT-Aの内容 → Wレジスタに書き込む)  

#### 未使用ピンは出力にすること  

### 条件分岐

#### BTFSC , BTFSS
  
BTFSC f,b: fレジスタのbビット目がビットが0なら次の行をスキップする  
BTFSS f,b: fレジスタのbビット目がビットが1なら次の行をスキップする  
なお、次の行をスキップするため、2行目に新しく条件分岐を記述することで細かい分岐にできる  
(なお、2行目にIFを入れないでGOTOで関数ジャンプ→ジャンプ先でIF処理もいける)  


### 初期設定  

#### ORG n

ORGは疑似命令で、プログラムを開始するアドレスを指定する  
ORG命令の次の行がORGで指定した番地nに書き込まれる  
例: 処理Aが00h番地に書かれる  
ORG 00h  
処理A  
  
#### 00hについて  

電源投入時やリセットされた時に、プログラムは00hから開始される  
そのため、割り込み処理が04hにある場合は、00hにgoto命令でジャンプさせて、  
その先でメインルーチンを書くようにすること  
※割り込み処理を使わない場合は、gotoで飛ばす必要はない  

### 遅延タイマー  

PICでは、**クロック4回で1つの命令**が実行され、これを**1サイクル**という  
使用するセラロックが10MHzだった場合の1サイクルにかかる時間:  
1/10,000,000 x 4 = 0.0000004s == 1サイクル : 0.4μs  

1サイクルにかかる時間がわかるとタイマーを作ることができる  
以下は0.5秒のタイマーの計算例  

0.5s = 500ms = 500,000μsのタイマー  
500,000 / 0.4 = 1,250,000サイクル == 0.5sタイマ : 125万サイクル  
ただし、さすがに125万サイクル記述するのは容量的(8bit(256)しかないため)に現実的ではないため反復処理を作る  
1: 0.4msecの処理を250回行う処理(100msec分)を書く  
2: 100msecを5回繰り返す処理を書く  
これで、0.5sとなる  










